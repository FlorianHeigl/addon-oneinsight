<!DOCTYPE html>
<html lang="en">
  <head>
  <title>ONE Insight - Host Usage</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <script type="text/javascript" src="js/raphael-min.js"></script>
    <script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css" media="screen">
    <link rel="stylesheet" href="css/bootswatch.min.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="../bower_components/html5shiv/dist/html5shiv.js"></script>
      <script src="../bower_components/respond/dest/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a href="../" class="navbar-brand">Rohol, by RealOpInsight Labs</a>
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div class="navbar-collapse collapse" id="navbar-main">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="themes">Nodes <span class="caret"></span></a>
              <ul class="dropdown-menu" aria-labelledby="themes">
                <li><a tabindex="-1" href="../default/">Default</a></li>
              </ul>
            </li>
          </ul>

          <ul class="nav navbar-nav navbar-right">
          <li><a href="help.html">Help</a></li>
          </ul>

        </div>
      </div>
    </div>

       <div class="page-header"><h1>ONE's Instant Resource Usage</h1></div>
        <!-- the html element where to put the paper -->
        <div id="HostLoad"></div>

        <!-- a script that create's a paper and a rectangle -->
        <script type="text/javascript">
        $(document).ready(
        function()
        {
      $.ajax(
      {
         type: "GET",
         url: "onehost.xml",
         dataType: "xml",
         success: function(xml)
         {
             $(xml).find('methodResponse').find('data').each(
             function()
             {
               if ($(this).find('boolean').text() == 1)
               {
                 var HOST_INIT                 = 0; // Initial state for enabled hosts
                 var HOST_MONITORING_MONITORED = 1; // Monitoring the host (from monitored)
                 var HOST_MONITORED            = 2; // The host has been successfully monitored
                 var HOST_ERROR                = 3; // An error ocurrer while monitoring the host
                 var HOST_DISABLED             = 4; // The host is disabled won't be monitored
                 var HOST_MONITORING_ERROR     = 5; // Monitoring the host (from error)
                 var HOST_MONITORING_INIT      = 6; // Monitoring the host (from init)
                 var HOST_MONITORING_DISABLED  = 7; // Monitoring the host (from disabled)

                 var DRAWING_AREA = new Object();
                     DRAWING_AREA.width = 800,
                     DRAWING_AREA.height = '100%';

                 var BASE_SHAPE_INFO = new Object();
                     BASE_SHAPE_INFO.unit = 10,
                     BASE_SHAPE_INFO.margin = 2;
                     BASE_SHAPE_INFO.node_margin = 4;

                 var curPos = new Object();
                     curPos.x = BASE_SHAPE_INFO.node_margin,
                     curPos.y = BASE_SHAPE_INFO.node_margin;

                 var paper = Raphael("HostLoad", DRAWING_AREA.width, DRAWING_AREA.height);

                 $( $.parseXML( $(this).find('string').text() ) ).find('HOST').each(
                 function()
                 {
                   var nbCpu = Math.ceil($(this).find('MAX_CPU').text() / 100);
                   var nbRow = 1;
                   var nbCol = 1;

                   switch(nbCpu) {
                   case 1:
                     nbRow = 1;
                   break;
                   case 2:
                   case 4:
                     nbRow = 2;
                   break;
                   case 6:
                   case 12:
                     nbRow = 6;
                   case 8:
                   case 16:
                     nbRow = 4;
                   break;
                   default:
                     if (nbCpu % 4 == 0)
                       nbRow = 4;
                     else if (nbCpu % 6 == 0)
                       nbRow = 6;
                     else if (nbCpu % 8 == 0)
                       nbRow = 8;
                     else
                       nbRow = Math.ceil(nbCpu);
                   break;
                   }

                   nbCol = Math.ceil(nbCpu / nbRow);

                   var curNodeShape = new Object();
                       curNodeShape.width  = nbCol * BASE_SHAPE_INFO.unit + (nbCol - 1) * BASE_SHAPE_INFO.margin;
                       curNodeShape.height = nbRow * BASE_SHAPE_INFO.unit + (nbRow - 1) * BASE_SHAPE_INFO.margin;

                   if (curPos.x + curNodeShape.width > DRAWING_AREA.width) {
                     curPos.y += curNodeShape.height + BASE_SHAPE_INFO.node_margin;
                     curPos.x = BASE_SHAPE_INFO.node_margin;
                   }

                   var nodeInfo = new Object();
                       nodeInfo.name = $(this).find('HOSTNAME').text();
                       nodeInfo.state = parseInt( $(this).find('STATE').text() );
                       nodeInfo.cpuUsage = parseInt( $(this).find('CPU_USAGE').text() );

                   switch (nodeInfo.state) {
                   case HOST_MONITORED:
                   case HOST_MONITORING_MONITORED:
                     if (nodeInfo.cpuUsage ==0)
                       nodeInfo.color = '#10A2eb';
                     else if (nodeInfo.cpuUsage <=25)
                       nodeInfo.color = '#ff00ff';
                     else if (nodeInfo.cpuUsage <=50)
                       nodeInfo.color = '#c0c0c0';
                     else if (nodeInfo.cpuUsage <=75)
                       nodeInfo.color = '#00ff00';
                     else
                       nodeInfo.color = '#ffa500';
                   break;
                   case HOST_ERROR:
                   case HOST_MONITORING_ERROR:
                     nodeInfo.color = '#ff0000';
                   break;
                   case HOST_INIT:
                   case HOST_DISABLED:
                   case HOST_MONITORING_INIT:
                   case HOST_MONITORING_DISABLED:
                     nodeInfo.color = '#c0c0c0';
                   break;
                   }

                   nodeInfo.shape = paper.set();
                   for (var index=0; index< nbCpu; ++index) {
                     var curShape = paper.rect(curPos.x + Math.floor(index / nbRow) * (BASE_SHAPE_INFO.unit + BASE_SHAPE_INFO.margin),
                                               curPos.y + (index % nbRow) * (BASE_SHAPE_INFO.unit + BASE_SHAPE_INFO.margin),
                                               BASE_SHAPE_INFO.unit,
                                               BASE_SHAPE_INFO.unit)
                     curShape.attr({fill: nodeInfo.color, 'stroke-width': 0});
                     nodeInfo.shape.push(curShape);
                   }
                   nodeInfo.shape.click(function(evt){
                     //TODO: console.log(nodeInfo.name);
                   });
                   curPos.x += curNodeShape.width + BASE_SHAPE_INFO.node_margin;
                 });
              }
           }
         );
        }
      });
    }
   );
</script>

      <footer>
        <div class="row">
          <div class="col-lg-12">
            <ul class="list-unstyled">
              <li><a href="https://twitter.com/realopinsight">Twitter</a></li>
              <li><a href="https://github.com/rchakode/realopinsight/">GitHub</a></li>
              <li><a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=F22JEM3Q78JC2">Donate</a></li>
            </ul>
            <p>Made by <a href="http://realopinsight.com">Rodrigue Chakode</a>. Code licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache
License v2.0</a>.</p>
          </div>
        </div>
      </footer>
    </div>

    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootswatch.js"></script>
  </body>
</html>
